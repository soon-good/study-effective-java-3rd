# 80프로성공

상용에 한번에 밀어넣기는 문제 없이 잘 됐다. 새벽12시 반 \~ 새벽5시 사이에 주식 1만개를 테스트했는데, 결과는 아래와 같았다.

- PRE MARKET \~ 11시 반 : 성공. 안정적이었다.

- 새벽 12시 반 \~ 새벽 4시 반 : 1만개 데이터 트래픽 저장/MQ 푸시/웹소켓 트래픽 처리 모두 안정적이었다.
  - 안정적이었다. 힙메모리 3% \~ 14.22 % 사이내에서 동작했다.
- 새벽 4시 반 ~ 새벽 5시 : 동작은 하지만, 느려졌다.
  - 불안정하다.
  - 힙 메모리도 70%까지 올라갔던걸로 기억한다.
  - 자세한건 애플리케이션 로그, 메모리 덤프, 스레드 덤프를 확인해봐야 알수 있다.
  - 아마도 인공지능 관련 서비스가 이용하는 가격API의 DB 참조가 문제일 것으로 추측 중이다.

<br>

원래 새벽 테스트 계획은 12시 반 \~ 3시 반이 계획이었다. 4시부터는 인공지능 관련 서비스가 바라보는 API가 테이블을 조회하게 되서 성능을 장담할 수 없어서 가급적 3시 반까지가 안정적이었다. 그런데 왠걸, 새벽 12시 반 \~ 새벽 4시까지 힙메모리 3% \~ 14.22% 사이로 안정적으로 돌아갔었다.<br>

그래서 4시 반까지도 운영해보니 데이터 저장 지연 현상 없이 잘 됐다. 그런데 문제는 4시 반 이후였다. 4시 반 이후로는 1분씩 지연되더니, 장 마감 5분전에는 최대 10분 이상 지연되어 저장되었다. 이때 4시 반 \~ 5시 사이에 스레드 덤프와 메모리 덤프를 떴는데, 문제 확인이 잘 될지는 나도 장담을 못하겠다. <br>

이번주는 이걸 해결하는 것과 모니터링을 해야하기에 매일 야간 모니터링을 하게 될 듯 하다. 낮 3시부터 출근가능할지 물어보든가 해야할 듯 하다. 그렇게 안되면 내 몸이 망가질 수도 있으니 알아서 업무시간에 조금씩 잠을 자든가 하는 방식으로 조절해야겠지. 말이 통할지는 나도 모르겠다. 지금까지 워킹타임에 강제로 일해왔으니.<br>

아무튼 오늘 글의 요점은... 

- 지난 번에 적었듯이 cbt/beta 테스트 없이 한번에 밀어넣어서 배포하라고 한 것은 성공했다.
- 이걸 하느라 하루에 한시간씩 자가면서 피말리게 코드들을 다시보고 또보고 그랬다. 메모리 덤프 봐가면서 힙메모리 최적화 작업을 했었지.
- 폐장 30분 전에는 데이터 저장이 지연되었다. 아마도 인공지능 서비스 지원관련 API 때문인 듯 하다.
- 이것 관련해서 커뮤니케이션 하는 것도 답답할듯 하다.
- 그냥 내가 데이터 원본을 그대로 레디스에 데이터 넣어주면 안되나 싶기도 하긴 하다.;;; 지들끼리 한자리 씩 해먹어야 한다는 생각에 가격 API 개발자라는 그럴듯한 직함만들어서 담당자 앉혀놓고 정치질을 하니.. 답답한 인간들이다. (지금 회사는 몇몇 사람을 제외하곤 대부분 인맥위주로 구성된 스타트업이라 비선실세같은 존재들이 좀 있다. ..)
- 이것도 본인들끼리 의사결정할때까지 한달 이상 걸리지 않을까 싶다. 

<br>

그리고 오늘부터 느낀점...<br>

- 인수인계는 싹다 테스트 코드로 남겨서 깔끔하게 쉽게 되게끔 하려고 생각 중이다.
- 이제 다음 직장구하기 준비 + 테스트코드 작성 퀘스트가 남았다.
- 코딩테스트 준비 시작해야 할듯하다.
- 월급 없이 최대 한달 \~ 두달을 버텨야 할수도 있다는게 겁이 조금 나기는 하는데, 지금 회사에 계속 재직하는 게 더 생명에 위협적이라는 결론이 들었다.




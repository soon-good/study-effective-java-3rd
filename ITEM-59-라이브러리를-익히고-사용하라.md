# 아이템 59. 라이브러리를 익히고 사용하라

직접 만들어 사용하는 것보다 가급적 표준 라이브러리에서 지원하는 기능이 있다면 표준 라이브러리를 사용하는 것이 권장된다. <br>

표준 라이브러리에 많은 장점들이 있지만 실상은 많은 프로그래머가 직접 구현해 사용하는 경우가 많다. 이유는 실제로 표준 라이브러리에 그런 기능이 있는지 모르기 때문인 경우가 많다. 메이저릴리즈마다 주목할 만한 수 많은 기능이 라이브러리에 추가된다.<br>

자바는 메이저 릴리즈마다 새로운 기능을 설명하는 웹페이지를 공시하는데, 한번쯤 읽어볼만하다.

- Java8 - [What's New Java 8](https://www.oracle.com/java/technologies/javase/8-whats-new.html)<br>
- Java9 - [What's New Java 9](https://docs.oracle.com/javase/9/whatsnew/toc.htm#JSNEW-GUID-C23AFD78-C777-460B-8ACE-58BE5EA681F6)<br>
- Java10 - [What's New Java 10](https://www.oracle.com/java/technologies/javase/10-relnote-issues.html#NewFeature)<br>
- Java11 - [What's New Java 11](https://www.oracle.com/java/technologies/javase/11-relnote-issues.html)<br>
- Java 16 - [What's New Java 16](https://www.oracle.com/java/technologies/javase/16-relnote-issues.html)<br>

<br>

>  Java 12 ~ Java 15 의 기능은 직접 다시 찾아서 다른 문서에 정리 후 링크 연결 예정. 구글 검색시 검색어를 `new feature java [버전숫자] oracle`  과 같이 입력해서 검색하면 각 버전별 릴리즈 소개 페이지가 나타난다.<br>
>
> 공식 홈페이지 외에도 해외 블로거 등이 작성해둔 요약 페이지가 나타나는데 이 페이지들도 직접 읽어보니 유용했던 것 같다.<br>

<br>

예를 들면 Java 9 에는 curl 과 같은 터미널 명령어와 같은 동작을 하는 기능을 `InputStream` 클래스 내에 `transferTo` 메서드로 제공해주고 있다.

```java
public static void main(String [] args){
    try(InputStream in = new URL(args[0]).openStream()){
        in.transferTo(System.out);
    }
}
```

<br>

## 핵심정리

바퀴를 다시 발명하지 말자. 아주 특별한 나만의 기능이 아니라면 누군가 이미 라이브러리 형태로 구현해놓았을 가능성이 크다. 그런 라이브러리가 있다면 쓰면 된다. 있는지 잘 모르겠다면 찾아보라. 일반적으로 라이브러리의 코드는 여러분이 직접 작성한 것 보다 품질이 좋고, 점차 개선될 가능성이 크다. 여러분의 실력을 폄하하는 것이 아니다. 코드 품질에도 규모의 경제가 적용된다. 즉, 라이브러리 코드는 개발자 각자가 작성하는 것보다 주목을 훨씬 많이 받으므로 코드 품질도 그만큼 높아진다.<br>

<br>

## 표준라이브러리를 사용하는 것의 장점

- 그 코드를 작성한 전문가의 지식과 여러분보다 앞서 사용한 다른 프로그래머들의 경험을 활용할 수 있다.
- 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다.
- 따로 노력하지 않아도 성능이 지속적으로 개선된다.
- 기능이 점점 많아진다.
- 여러분이 직접 작성한 코드가 많은 사람들에게 낯익은 코드가 된다. 자연스럽게 다른 개발자들이 더 읽기 좋고, 유지보수하기 좋고 재활용하기 좋은 코드가 된다.

<br>

## 잘 알려진 표준 라이브러리들

자바 API는 매우 범위가 광범위해서 모든 API 를 공부하기에는 벅차다.(저자도 직접 인정함)<br>

라이브러리 들 중에서도 잘 알려지고 유용하고 자주 사용될 수 있는 API가 속한 패키지들은 아래와 같다. 가급적 아래의 패키지들에 있는 라이브러리들에는 익숙해지는 게 좋다.

- `java.lang`
- `java.util`
- `java.io`
- `java.util.concurrent`

<br>

## ex) 난수 생성기능 구현

아래의 코드는 그대로 사용하기에는 문제가 있다. 소스코드는 저자이신 조슈아 블로크 아저씨의 개인 [깃헙](https://github.com/jbloch/effective-java-3e-source-code/blob/master/src/effectivejava/chapter9/item59/RandomBug.java) 에서 가져왔다.

```java
package effectivejava.chapter9.item59;
import java.util.*;

// Random number generation is hard! - Page 215
public class RandomBug {
    // Common but deeply flawed!
    static Random rnd = new Random();

    static int random(int n) {
        return Math.abs(rnd.nextInt()) % n;
    }

    public static void main(String[] args) {
        int n = 2 * (Integer.MAX_VALUE / 3);
        int low = 0;
        for (int i = 0; i < 1000000; i++)
            if (random(n) < n/2)
                low++;
        System.out.println(low);
    }
}
```

<br>

위 코드는 괜찮아 보여도 3가지 문제점을 가지고 있다.<br>

첫번째,<br>

- n 이 그리 크지 않은 2의 제곱수일 경우 얼마 지나지 않아 같은 수열이 반복된다.

두번째,<br>

- n 이 2의 제곱수가 아니라면 몇몇 숫자가 평균적으로 더 자주 반환된다. n 값이 크면 이 현상은 더 두드러진다.

세번째,<br>

- 지정한 범위 '바깥'의 수가 종종 튀어나올 수 있다.
- `rnd.nextInt()` 가 Integer.MIN_VALUE 를 리턴하는 경우를 생각해보자.
- `rnd.nextInt()` 가 `Integer.MIN_VALUE` 를 리턴하면, `rnd.nextInt()` 를 `Math.abs(...)` 로 감싸놓았어도 음수가 나타날 확율이 존재하게 된다. 이유는 아래와 같다.
- int 자료형의 음수는 양수의 갯수보다 하나 더 많은데, Integer.MIN_VALUE 를 사용하게 되면, 양수로 Integer.MIN_VALUE를 표현할 적당한 방법이 없다. Integer.MIN_VALUE 를 Math.abs로 절대값 처리를 해도, 표현범위 바깥이기에 오버플로우 되어 음수가 나타날 가능성이 존재하게 된다.<br>

<br>

이와 같은 문제를 해결하기 위해서는 의사난수 생성기, 정수론, 2의 보수 계산 등에 대해 조예가 깊어야 한다. 위와 같은 문제를 해결한 자바의 API 는 `Random.nextInt(int)` 가 있다. <br>

<br>

**API 라이브러리 갭ㄹ의 생태계 역시 규모의 경제를 가지고 있다.**<br>

위와 같은 라이브러리는 저명한 대학교에서 수학이나 컴퓨터공학을 전공한 사람들이 Oracle 과 같은 회사에 취직하거나 석/박사 등을 하면서 해당 회사에 인턴쉽으로 취업한 상태에서 일을 하면서 현업에서 개발하던 것을 연구 논문으로 작성하기도 한다고 몇년 전 구글 밋업으로 해외 개발자와 진행했던 스터디에서 얼핏 들은 것 같다. 이 라이브러리를 작성한 사람들은 하루 9시간, 모든 워킹 타임을 월급을 받아가면서 위 코드만을 작성한 것이기에, 라이브러리의 도움을 받는 것이 훨씬 유용하다.<br>

책에서도 `API 라이브러리 개발의 생태계 역시 규모의 경제를 가지고 있다.` 라고 매우 애둘러서 간접적으로 표현하고 있다. 그만큼 시간을 많이 쓰고, 스트레스 많이 받아가면서 라이브러리 개발하고, 그만한 월급을 크게 받는 사람들이 많이 투입되는 등을 간접적으로 규모의 경제를 가지고 있다. 하고 에둘러 표현한건 아닐까 하고 생각했다.<br>

<br>

## 2022/02/21

 이 글을 쓰는 시점은 2022/02/22 새벽 4시 반이다. 지금 회사에서는 1달 전쯤 '장외 가격' 이라는 것을 개발을 시작했다. 난 주식에 대해 아무것도 모른다. 그런데 장외가격을 개발하란다. 기획문서도 없다. 그래서 혼자서 야후 파이낸스, 위불 사이트를 참고해서 서비스별 제공 데이터 차이점, 장외가격의 시간이 어느 시간대인지 찾아보고, 서머 타임때는 장외시간이 어떻게 되는지 파악해서 위키에 정리해두었었다. 물론 이것도 다른 일을 하면서 짬짬이 찾아봤다.<br>

 지금까지는 다른 일을 하면서, 장외 가격의 기능적인 부분들만 얼추 마무리 해놨었다. 오늘 기획이 필요하다고 하니 이유를 묻더라. 서비스 쪽은 기획을 추가해주면서, 왜 난 추가해주지 않는 걸까? 진짜 뭔가 `일해주는 가정부 같은 사람을 고용한건가?` 싶었다. 입사 초기부터 이런 생각이 자주 들었었다. <br>

입사 시에는 갑자기 입사한지 이틀도 안됐는데 내일까지 MQ 로 프로젝트 만드십시오. 하는데 뭘 만들라는 건지 모르는 상황이 많았다. 전직장이 같은 회사 동료는 기획챙겨주고, 일정 챙겨주고 본인 나와바리는 어지간히 챙기는게 조금 심한데... 너무 차별이 심한거 아닌가? 하고 자주 생각했었다. <br>

내가 왜 중간에 발을 빼지 못한걸까? 하는 생각이 요즘은 든다. 내가 왜 이 사람들 회사에 잘못 들어온건데 우연히 맡게된 데이터 개발 마무리 짓고 나오겠다고 생각한걸까?  내가 왜 내가 뭐라고 이 사람들이 스타트업은 사람 뽑기 힘들다면서 배려해준걸까? 연봉은 포기해도 개발 체계를 제대로 갖춘 회사로 갈 수 있었는데, 왜 여기를 택한걸까? 하고 나 자신의 어리석음에 허탈하게 웃을때가 많다. 지금 회사는 구성원들이 나이가 어린건지, 갑마인드가 많은건지 참... 앞에서는 웃으면서 말할 수 밖에 없지만... 속은 이미 새까맣게 타서 그 사람이 너무 싫어질 때가 한 두번이 아니다..<br>

4월 부터는 정식으로 이직준비 시작하고 회사에는 미리 알리고 정식으로 인수인계를 시작할 것 같다. 그때 까지는 계속 개념 정리 계속하고 그래야 할 듯 하다. 연봉이 많이 깎이더라도, 중간에 회사가 폐업이 되더라도 정말 테스트 코드 하나는 꼭 작성하거나, 적어도 맡은일을 대리분담해줄 수 있는 최소한도의 인력 풀은 갖춘 회사로 이직해야지. 지금 회사는 한 사람한테 죄다 짬시키고 시키면, 생각한대로 말만 하면 다 되는줄 안다. 일 하는 사람은 한 사람인데, 시간은 정해져있고, 요구사항은 뭐 그리 많은지, 요구하거나 말하는 데에 일정을 고려하는 것도 없고, 매너라는 것도 없고, 정말 너무 힘들다. 이렇게 힘든 것도 끝물인데, 끝물이 이렇게 쓴가 싶다.<br>

<br>